---
layout: post
title: 硬件性能衡量时间尺度
description: ""
category: 硬件
tags: [hardware, perfmance, modern computer]
---
{% include JB/setup %}

——————————————————————————————————————————————

多核心 APIC 多级TLB  多级Cache 内存


————————————————————————————————————————————————————————


## 主频\外频

根据《深入理解Linux内核》定时测量一章，操作系统的视角下一般有三个时钟：
* 一个用来提供实时时间，也就是RTC。频率一般在2-8192Hz左右，也就是最高精度大约100微秒，实际上常常是秒级精度。C标准库中的time()与gettimeofday()就是指的它。
* 一个用来驱动CPU运行，也就是TSC。主频指的就是它。实际的晶振一般在100Mhz左右，无法产生Ghz的震荡。现代CPU上GHz的主频是通过晶振加电路倍频后得到的。可以通过汇编指令rdtsc来读取这个值，获得精度非常高的时间。但是由于睿频等技术，cpu的主频其实是一直在变化的，再一个如果用它来统计程序运行时间的话，是包括用户态与内核态以及之间切换的总的时间，而通常情况下我们只关心用户态的时间。
	```
	unsigned long long native_read_tsc(void)
	{
	        unsigned long long val;
	        asm volatile("rdtsc": "=A" (val));
	        printf("tsc:%lld\n",val);
	        return val;
	}
	```
	
* 一个用来驱动操作系统的运行，也就是intel SMP下的APIC，也就是常说的时钟中断。C标准库中的clock()函数就是取这个时钟节拍数，C标准库同时定义了CLOCKS_PER_SEC这个常量，一般在1K左右，也就是时间精度最高1ms。


而外频通常意义上可以理解为系统总线的频率。但是总线频率与内存频率还不一样。


## 带宽与吞吐量

内存只需要输出数据

CPU则数据与地址都要输出

数据总线的宽度
内存的单双通道


## CPU执行速度
一条指令的时间

平均指令周期数有没有可靠的数据

多级流水线


## 现代计算机各硬件访问延时


## 高速缓存策略为什么能有效
内存与CPU的带宽
读取内存与CPU读取L1的延迟

## 上下文切换的开销
TLB

